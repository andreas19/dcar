
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>dcar.bus &#8212; D-Car 0.3.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">D-Car</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mod_api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  <li><a href="../dcar.html">dcar</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for dcar.bus</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Connection to message bus.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">.address</span> <span class="kn">import</span> <span class="n">Address</span>
<span class="kn">from</span> <span class="nn">.const</span> <span class="kn">import</span> <span class="n">DEFAULT_TIMEOUT_VALUE</span>
<span class="kn">from</span> <span class="nn">.errors</span> <span class="kn">import</span> <span class="n">Error</span><span class="p">,</span> <span class="n">TransportError</span>
<span class="kn">from</span> <span class="nn">.message</span> <span class="kn">import</span> <span class="n">HeaderField</span><span class="p">,</span> <span class="n">HeaderFields</span><span class="p">,</span> <span class="n">HeaderFlag</span><span class="p">,</span> <span class="n">Message</span><span class="p">,</span> <span class="n">MessageType</span>
<span class="kn">from</span> <span class="nn">.router</span> <span class="kn">import</span> <span class="n">Router</span>
<span class="kn">from</span> <span class="nn">.transports</span> <span class="kn">import</span> <span class="n">check_for_known_transport</span><span class="p">,</span> <span class="n">connect</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="Bus"><a class="viewcode-back" href="../../modules.html#dcar.Bus">[docs]</a><span class="k">class</span> <span class="nc">Bus</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Representation of a client&#39;s connection to a message bus.</span>

<span class="sd">    An instance of this class is the central point for a client to interact</span>
<span class="sd">    with a message bus. It can be used as a context manager. On entering the</span>
<span class="sd">    runtime context the :meth:`connect` method will be called, on exiting the</span>
<span class="sd">    :meth:`disconnect` method.</span>

<span class="sd">    :param address: same as for :class:`~dcar.address.Address` or an</span>
<span class="sd">                    :class:`~dcar.address.Address` object</span>
<span class="sd">    :type address: str or Address</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s1">&#39;session&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_router</span> <span class="o">=</span> <span class="n">Router</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unique_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">address</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="n">check_for_known_transport</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_address</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the actual address the client is connected to.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bus_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the bus type: ``&#39;system&#39;``, ``&#39;session&#39;`` , or ``None``.</span>

<span class="sd">        .. versionadded:: 0.3.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="o">.</span><span class="n">bus_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">connected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the client is connected.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">connected</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unique_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the unique name of the client&#39;s connection.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">guid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the GUID of the server.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">guid</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unix_fds_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether passing of unix file descriptors is enabled.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">unix_fds_enabled</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return transport error or  ``None``.</span>

<span class="sd">        This error is set when the client loses the connection to the message</span>
<span class="sd">        bus because of this error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">error</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="k">else</span> <span class="kc">None</span>

<div class="viewcode-block" id="Bus.raise_on_error"><a class="viewcode-back" href="../../modules.html#dcar.Bus.raise_on_error">[docs]</a>    <span class="k">def</span> <span class="nf">raise_on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Re-raises the :attr:`error` or does nothing.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">error</span></div>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="Bus.connect"><a class="viewcode-back" href="../../modules.html#dcar.Bus.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Connect to message bus.</span>

<span class="sd">        :raises ~dcar.AuthenticationError: if authentication failed</span>
<span class="sd">        :raises OSError: if connection failed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">authenticate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">start_loops</span><span class="p">()</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_call</span><span class="p">(</span><span class="s1">&#39;/org/freedesktop/DBus&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;org.freedesktop.DBus&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;Hello&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;org.freedesktop.DBus&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unique_name</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Bus.disconnect"><a class="viewcode-back" href="../../modules.html#dcar.Bus.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Disconnect the client.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span></div>

<div class="viewcode-block" id="Bus.block"><a class="viewcode-back" href="../../modules.html#dcar.Bus.block">[docs]</a>    <span class="k">def</span> <span class="nf">block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Blocks until ``send-loop`` and ``recv-loop``\</span>
<span class="sd">           are finished or timeout is reached.</span>

<span class="sd">        The ``send-loop`` and ``recv-loop`` threads are started when connecting</span>
<span class="sd">        to the D-Bus.</span>

<span class="sd">        :param float timeout: timeout value in seconds</span>
<span class="sd">                              (``None`` means no timeout)</span>

<span class="sd">        .. versionchanged:: 0.2.0 Add parameter ``timeout``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bus.send_message"><a class="viewcode-back" href="../../modules.html#dcar.Bus.send_message">[docs]</a>    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send a message.</span>

<span class="sd">        Normally :meth:`method_call`, :meth:`method_return`, :meth:`send_error`</span>
<span class="sd">        or :meth:`emit_signal` should be used.</span>

<span class="sd">        :param Message msg: the message</span>
<span class="sd">        :param float timeout: ``None`` = no timeout, ``0`` = no reply expected</span>
<span class="sd">                              and ``&gt; 0`` = timeout in seconds</span>
<span class="sd">        :returns: return values of the message call if a reply is expected</span>
<span class="sd">                  else ``None``</span>
<span class="sd">        :rtype: tuple or None</span>
<span class="sd">        :raises ~dcar.TransportError: if the message could not be sent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TransportError</span><span class="p">(</span><span class="s1">&#39;not connected&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timeout</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">HeaderFlag</span><span class="o">.</span><span class="n">NO_REPLY_EXPECTED</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="o">.</span><span class="n">outgoing</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bus.method_call"><a class="viewcode-back" href="../../modules.html#dcar.Bus.method_call">[docs]</a>    <span class="k">def</span> <span class="nf">method_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_path</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span>
                    <span class="o">*</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="n">DEFAULT_TIMEOUT_VALUE</span><span class="p">,</span> <span class="n">no_auto_start</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">allow_interactive_authorization</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send a message of type METHOD_CALL.</span>

<span class="sd">        :param str object_path: object path (required)</span>
<span class="sd">        :param str interface: interface name</span>
<span class="sd">        :param str method_name: method name (required)</span>
<span class="sd">        :param str destination: name of the destination&#39;s connection</span>
<span class="sd">        :param str sender: name of the sender&#39;s connection</span>
<span class="sd">        :param str signature: D-Bus types signature of the IN arguments</span>
<span class="sd">        :param tuple args: the IN arguments</span>
<span class="sd">        :param float timeout: ``None`` = no timeout, ``0`` = no reply expected</span>
<span class="sd">                              and ``&gt; 0`` = timeout in seconds</span>
<span class="sd">        :param bool no_auto_start: header flag</span>
<span class="sd">        :param bool allow_interactive_authorization: header flag</span>
<span class="sd">        :returns: return values of the method call if a reply is expected</span>
<span class="sd">                  else ``None``</span>
<span class="sd">        :rtype: tuple or None</span>
<span class="sd">        :raises ~dcar.TransportError: if the message could not be sent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header_fields</span> <span class="o">=</span> <span class="n">HeaderFields</span><span class="p">()</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="n">object_path</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">INTERFACE</span><span class="p">]</span> <span class="o">=</span> <span class="n">interface</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">MEMBER</span><span class="p">]</span> <span class="o">=</span> <span class="n">method_name</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">SENDER</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">SIGNATURE</span><span class="p">]</span> <span class="o">=</span> <span class="n">signature</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">HeaderFlag</span><span class="o">.</span><span class="n">NONE</span>
        <span class="k">if</span> <span class="n">no_auto_start</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">HeaderFlag</span><span class="o">.</span><span class="n">NO_AUTO_START</span>
        <span class="k">if</span> <span class="n">allow_interactive_authorization</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">HeaderFlag</span><span class="o">.</span><span class="n">ALLOW_INTERACTIVE_AUTHORIZATION</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">MessageType</span><span class="o">.</span><span class="n">METHOD_CALL</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">header_fields</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bus.method_return"><a class="viewcode-back" href="../../modules.html#dcar.Bus.method_return">[docs]</a>    <span class="k">def</span> <span class="nf">method_return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply_serial</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">signature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;Send a message of type METHOD_RETURN.</span>

<span class="sd">        :param int reply_serial: serial of the message for which this is</span>
<span class="sd">                                 a reply (required)</span>
<span class="sd">        :param str destination: name of the destination&#39;s connection</span>
<span class="sd">        :param str sender: name of the sender&#39;s connection</span>
<span class="sd">        :param str signature: D-Bus types signature of the OUT arguments of</span>
<span class="sd">                              the called method</span>
<span class="sd">        :param tuple args: the OUT arguments of the called method</span>
<span class="sd">        :raises ~dcar.TransportError: if the message could not be sent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header_fields</span> <span class="o">=</span> <span class="n">HeaderFields</span><span class="p">()</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">REPLY_SERIAL</span><span class="p">]</span> <span class="o">=</span> <span class="n">reply_serial</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">SENDER</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">SIGNATURE</span><span class="p">]</span> <span class="o">=</span> <span class="n">signature</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">MessageType</span><span class="o">.</span><span class="n">METHOD_RETURN</span><span class="p">,</span> <span class="n">HeaderFlag</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span>
                      <span class="n">header_fields</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bus.send_error"><a class="viewcode-back" href="../../modules.html#dcar.Bus.send_error">[docs]</a>    <span class="k">def</span> <span class="nf">send_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_name</span><span class="p">,</span> <span class="n">reply_serial</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">signature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;Send a message of type ERROR.</span>

<span class="sd">        :param str error_name: error name (required)</span>
<span class="sd">        :param int reply_serial: serial of the message for which this is</span>
<span class="sd">                                 a reply (required)</span>
<span class="sd">        :param str destination: name of the destination&#39;s connection</span>
<span class="sd">        :param str sender: name of the sender&#39;s connection</span>
<span class="sd">        :param str signature: D-Bus types signature of the arguments</span>
<span class="sd">        :param tuple args: the arguments</span>
<span class="sd">        :raises ~dcar.TransportError: if the message could not be sent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header_fields</span> <span class="o">=</span> <span class="n">HeaderFields</span><span class="p">()</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">ERROR_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_name</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">REPLY_SERIAL</span><span class="p">]</span> <span class="o">=</span> <span class="n">reply_serial</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">SENDER</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">SIGNATURE</span><span class="p">]</span> <span class="o">=</span> <span class="n">signature</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">MessageType</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="n">HeaderFlag</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="n">header_fields</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bus.emit_signal"><a class="viewcode-back" href="../../modules.html#dcar.Bus.emit_signal">[docs]</a>    <span class="k">def</span> <span class="nf">emit_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_path</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span> <span class="n">signal_name</span><span class="p">,</span>
                    <span class="n">destination</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;Send a message of type SIGNAL.</span>

<span class="sd">        :param str object_path: object path (required)</span>
<span class="sd">        :param str interface: interface name (required)</span>
<span class="sd">        :param str signal_name: signal name (required)</span>
<span class="sd">        :param str destination: name of the destination&#39;s connection</span>
<span class="sd">        :param str sender: name of the sender&#39;s connection</span>
<span class="sd">        :param str signature: D-Bus types signature of the arguments</span>
<span class="sd">        :param tuple args: the arguments</span>
<span class="sd">        :raises ~dcar.TransportError: if the message could not be sent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header_fields</span> <span class="o">=</span> <span class="n">HeaderFields</span><span class="p">()</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">PATH</span><span class="p">]</span> <span class="o">=</span> <span class="n">object_path</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">INTERFACE</span><span class="p">]</span> <span class="o">=</span> <span class="n">interface</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">MEMBER</span><span class="p">]</span> <span class="o">=</span> <span class="n">signal_name</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">DESTINATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">SENDER</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender</span>
        <span class="n">header_fields</span><span class="p">[</span><span class="n">HeaderField</span><span class="o">.</span><span class="n">SIGNATURE</span><span class="p">]</span> <span class="o">=</span> <span class="n">signature</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">MessageType</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">,</span> <span class="n">HeaderFlag</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span> <span class="n">header_fields</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bus.register_signal"><a class="viewcode-back" href="../../modules.html#dcar.Bus.register_signal">[docs]</a>    <span class="k">def</span> <span class="nf">register_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">unicast</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="n">DEFAULT_TIMEOUT_VALUE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a signal.</span>

<span class="sd">        The handler function must take one parameter:</span>
<span class="sd">        a :class:`~dcar.message.MessageInfo` object.</span>

<span class="sd">        .. note::</span>

<span class="sd">           The handler functions for incoming method calls and signals will be</span>
<span class="sd">           executed in a separate thread sequentially.</span>

<span class="sd">        :param ~dcar.MatchRule rule: the match rule</span>
<span class="sd">        :param callable handler: handler function for the signal</span>
<span class="sd">        :param bool unicast: if ``True`` this rule applies to a unicast</span>
<span class="sd">                             signal and no *AddMatch* message will</span>
<span class="sd">                             be sent to the message bus</span>
<span class="sd">        :param float timeout: timeout in seconds</span>
<span class="sd">        :return: ID of the signal</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        :raises ~dcar.RegisterError: if the signal could not be registered</span>
<span class="sd">        :raises ~dcar.TransportError: if the *AddMatch* message could</span>
<span class="sd">                                      not be sent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reg_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">unicast</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unicast</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">method_call</span><span class="p">(</span><span class="s1">&#39;/org/freedesktop/DBus&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;org.freedesktop.DBus&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;AddMatch&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;org.freedesktop.DBus&#39;</span><span class="p">,</span>
                                 <span class="n">signature</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rule</span><span class="p">),),</span>
                                 <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">Error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">reg_id</span><span class="p">)</span>
                <span class="k">raise</span>
        <span class="k">return</span> <span class="n">reg_id</span></div>

<div class="viewcode-block" id="Bus.unregister_signal"><a class="viewcode-back" href="../../modules.html#dcar.Bus.unregister_signal">[docs]</a>    <span class="k">def</span> <span class="nf">unregister_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg_id</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">DEFAULT_TIMEOUT_VALUE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unregister a signal.</span>

<span class="sd">        :param int reg_id: ID returned by :meth:`register_signal`</span>
<span class="sd">        :param float timeout: timeout in seconds</span>
<span class="sd">        :raises ~dcar.TransportError: if RemoveMatch message could not be sent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">reg_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rule</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_call</span><span class="p">(</span><span class="s1">&#39;/org/freedesktop/DBus&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;org.freedesktop.DBus&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;RemoveMatch&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;org.freedesktop.DBus&#39;</span><span class="p">,</span>
                             <span class="n">signature</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rule</span><span class="p">),),</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bus.register_method"><a class="viewcode-back" href="../../modules.html#dcar.Bus.register_method">[docs]</a>    <span class="k">def</span> <span class="nf">register_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_path</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span>
                        <span class="n">handler</span><span class="p">,</span> <span class="n">signature</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a method.</span>

<span class="sd">        The handler function must take two parameters:</span>
<span class="sd">        a :class:`Bus` object and</span>
<span class="sd">        a :class:`~dcar.message.MessageInfo` object.</span>

<span class="sd">        .. note::</span>

<span class="sd">           The handler functions for incoming method calls and signals will be</span>
<span class="sd">           executed in a separate thread sequentially.</span>

<span class="sd">        :param str object_path: object path</span>
<span class="sd">        :param str interface: interface name</span>
<span class="sd">        :param str method_name: method name</span>
<span class="sd">        :param str signature: D-Bus type signatures of the arguments</span>
<span class="sd">        :return: ID of the method</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        :raises ~dcar.RegisterError: if the method could not be registered</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">object_path</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span>
                                         <span class="n">method_name</span><span class="p">),</span> <span class="n">handler</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span></div>

<div class="viewcode-block" id="Bus.unregister_method"><a class="viewcode-back" href="../../modules.html#dcar.Bus.unregister_method">[docs]</a>    <span class="k">def</span> <span class="nf">unregister_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meth_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unregister a method.</span>

<span class="sd">        :param int meth_id: ID returned by :meth:`register_method`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_router</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">meth_id</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2019-2020, Andreas Suhre.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>